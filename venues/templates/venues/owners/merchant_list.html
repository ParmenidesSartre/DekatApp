{% extends "venues/base.html" %}

{% block title %}Merchants - {{ venue.name }} - Dekat{% endblock %}

{% block content %}
<!-- Header -->
<div class="bg-white/60 backdrop-blur-md rounded-5xl p-6 md:p-10 border border-white shadow-card">
    <div class="flex flex-wrap items-start justify-between gap-4">
        <div>
            <a href="{% url 'venue_dashboard' venue.id %}" class="text-sm text-brand-main hover:text-brand-dark mb-2 inline-block">
                <i class="fa-solid fa-arrow-left"></i> Back to Dashboard
            </a>
            <h1 class="font-display font-bold text-2xl text-gray-900">Merchants</h1>
            <p class="text-sm text-gray-600 mt-1">{{ venue.name }} - {{ merchants|length }} total</p>
        </div>
        <a href="{% url 'merchant_add' venue.id %}" class="inline-flex items-center gap-2 bg-brand-main text-white font-display font-bold py-3 px-6 rounded-3xl shadow-cute hover:shadow-cute-hover hover:translate-y-1 transition-all">
            <i class="fa-solid fa-plus"></i> Add Merchant
        </a>
    </div>
</div>

<!-- Display Django messages -->
{% if messages %}
<div class="mt-6 space-y-2">
    {% for message in messages %}
    <div class="bg-{% if message.tags == 'error' %}red{% elif message.tags == 'success' %}green{% else %}blue{% endif %}-100 border border-{% if message.tags == 'error' %}red{% elif message.tags == 'success' %}green{% else %}blue{% endif %}-400 text-{% if message.tags == 'error' %}red{% elif message.tags == 'success' %}green{% else %}blue{% endif %}-700 px-4 py-3 rounded-2xl" role="alert">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Merchant List -->
<div class="mt-6">
    {% if merchants %}
    <div class="space-y-4">
        {% for merchant in merchants %}
        <div class="bg-white rounded-3xl p-5 border border-slate-100 shadow-soft hover:shadow-md transition-shadow">
            <div class="flex items-start justify-between gap-4">
                <!-- Merchant Info -->
                <div class="flex gap-4 min-w-0 flex-1">
                    {% if merchant.logo %}
                    <img src="{{ merchant.logo.url }}" alt="{{ merchant.name }}" class="w-16 h-16 rounded-xl object-cover flex-shrink-0">
                    {% else %}
                    <div class="w-16 h-16 rounded-xl bg-gray-200 flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-store text-gray-400 text-xl"></i>
                    </div>
                    {% endif %}
                    <div class="min-w-0 flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <h3 class="font-display font-bold text-lg text-gray-900 truncate">{{ merchant.name }}</h3>
                            {% if merchant.is_featured %}
                            <span class="inline-flex items-center gap-1 text-xs font-extrabold px-2 py-1 rounded-lg bg-yellow-100 text-yellow-700 flex-shrink-0">
                                <i class="fa-solid fa-star"></i> Featured
                            </span>
                            {% endif %}
                        </div>
                        <div class="text-sm text-gray-600 mb-2">
                            <span class="font-semibold">{{ merchant.floor.name }}</span>
                            {% if merchant.lot_number %} • {{ merchant.lot_number }}{% endif %}
                            {% if merchant.category %} • {{ merchant.category.name }}{% endif %}
                        </div>
                        {% if merchant.description %}
                        <p class="text-sm text-gray-500 line-clamp-2">{{ merchant.description }}</p>
                        {% endif %}
                        <div class="flex flex-wrap gap-2 mt-2">
                            {% if merchant.is_halal %}
                            <span class="text-xs font-semibold px-2 py-1 rounded-lg bg-green-100 text-green-700">
                                <i class="fa-solid fa-check-circle"></i> Halal
                            </span>
                            {% endif %}
                            {% if merchant.accepts_ewallet %}
                            <span class="text-xs font-semibold px-2 py-1 rounded-lg bg-blue-100 text-blue-700">
                                <i class="fa-solid fa-wallet"></i> E-Wallet
                            </span>
                            {% endif %}
                            {% if merchant.phone_number %}
                            <span class="text-xs font-semibold px-2 py-1 rounded-lg bg-gray-100 text-gray-700">
                                <i class="fa-solid fa-phone"></i> {{ merchant.phone_number }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex flex-col gap-2 flex-shrink-0">
                    <a href="{% url 'merchant_edit' venue.id merchant.id %}" class="inline-flex items-center justify-center gap-1 bg-white text-slate-700 border border-slate-200 font-display font-bold text-xs px-3 py-2 rounded-2xl hover:shadow-md transition-all">
                        <i class="fa-solid fa-pen"></i> Edit
                    </a>
                    <form method="post" action="{% url 'merchant_toggle_featured' venue.id merchant.id %}">
                        {% csrf_token %}
                        <button type="submit" class="w-full inline-flex items-center justify-center gap-1 bg-white text-yellow-600 border border-yellow-200 font-display font-bold text-xs px-3 py-2 rounded-2xl hover:bg-yellow-50 transition-all">
                            <i class="fa-solid fa-star"></i> {% if merchant.is_featured %}Unfeature{% else %}Feature{% endif %}
                        </button>
                    </form>
                    <form method="post" action="{% url 'merchant_delete' venue.id merchant.id %}" onsubmit="return confirm('Are you sure you want to delete {{ merchant.name }}? This cannot be undone.');">
                        {% csrf_token %}
                        <button type="submit" class="w-full inline-flex items-center justify-center gap-1 bg-white text-red-600 border border-red-200 font-display font-bold text-xs px-3 py-2 rounded-2xl hover:bg-red-50 transition-all">
                            <i class="fa-solid fa-trash"></i> Delete
                        </button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-white rounded-5xl p-12 text-center border border-slate-100 shadow-soft">
        <i class="fa-solid fa-store text-6xl text-gray-300 mb-4"></i>
        <h3 class="font-display font-bold text-xl text-gray-900 mb-2">No merchants yet</h3>
        <p class="text-gray-600 mb-6">Add your first merchant to get started!</p>
        <a href="{% url 'merchant_add' venue.id %}" class="inline-flex items-center gap-2 bg-brand-main text-white font-display font-bold py-3 px-6 rounded-3xl shadow-cute hover:shadow-cute-hover hover:translate-y-1 transition-all">
            <i class="fa-solid fa-plus"></i> Add First Merchant
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
